<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет - CryptoWatch MEXC</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="icon" type="image/png" href="https://cryptowatch-mexc.onrender.com/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Navigation Sidebar -->
        <nav class="dashboard-sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>CryptoWatch</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <a href="#overview" class="menu-item active" data-tab="overview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Обзор</span>
                </a>
                <a href="#signals" class="menu-item" data-tab="signals">
                    <i class="fas fa-broadcast-tower"></i>
                    <span>Сигналы</span>
                </a>
                <a href="#analytics" class="menu-item" data-tab="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Аналитика</span>
                </a>
                <a href="#portfolio" class="menu-item" data-tab="portfolio">
                    <i class="fas fa-wallet"></i>
                    <span>Портфель</span>
                </a>
                <a href="#settings" class="menu-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Настройки</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2300D4FF'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' fill='white' text-anchor='middle' dy='0.35em'%3EA%3C/text%3E%3C/svg%3E" alt="Avatar">
                    </div>
                    <div class="user-info">
                        <span class="username" id="dashboardUsername">Администратор</span>
                        <span class="user-email" id="dashboardEmail">adm1n</span>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Выйти</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="dashboard-main">
            <header class="dashboard-header">
                <div class="header-left">
                    <h1 id="pageTitle">Обзор</h1>
                    <p id="pageSubtitle">Добро пожаловать в панель управления CryptoWatch MEXC</p>
                </div>
                <div class="header-right">
                    <div class="header-stats">
                        <div class="header-stat">
                            <span class="stat-label">Статус</span>
                            <span class="stat-value online">
                                <i class="fas fa-circle"></i>
                                Онлайн
                            </span>
                        </div>
                        <div class="header-stat">
                            <span class="stat-label">Последнее обновление</span>
                            <span class="stat-value" id="lastUpdate">только что</span>
                        </div>
                    </div>
                    <button class="refresh-btn" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </header>

            <div class="dashboard-content">
                <!-- Overview Tab -->
                <div class="tab-content active" id="overviewTab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-signal"></i>
                                </div>
                                <div class="stat-card-title">Активные сигналы</div>
                            </div>
                            <div class="stat-card-value" id="activeSignals">23</div>
                            <div class="stat-card-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12 за сегодня</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="stat-card-title">Точность сигналов</div>
                            </div>
                            <div class="stat-card-value" id="winRate">87.3%</div>
                            <div class="stat-card-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>-2.1% за неделю</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-card-title">Общая прибыль</div>
                            </div>
                            <div class="stat-card-value" id="totalProfit">15.2%</div>
                            <div class="stat-card-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+3.2% за месяц</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-card-title">Пользователи</div>
                            </div>
                            <div class="stat-card-value" id="totalUsers">2,847</div>
                            <div class="stat-card-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+156 сегодня</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Recent Activity -->
                    <div class="charts-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Производительность за последние 30 дней</h3>
                                <div class="chart-filters">
                                    <button class="filter-btn active" data-period="7d">7Д</button>
                                    <button class="filter-btn" data-period="30d">30Д</button>
                                    <button class="filter-btn" data-period="90d">90Д</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="performanceChart" style="height: 300px;"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Последние сигналы</h3>
                                <a href="#signals" class="view-all" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Смотреть все</a>
                            </div>
                            <div class="signals-list" id="recentSignalsList">
                                <!-- Populated by JavaScript -->
                                <div class="signal-item">
                                    <div class="signal-info">
                                        <div class="signal-symbol">BTC/USDT</div>
                                        <div class="signal-time">2 часа назад</div>
                                    </div>
                                    <div class="signal-action buy">BUY</div>
                                    <div class="signal-profit positive">+2.3%</div>
                                    <div class="signal-status completed">Завершен</div>
                                </div>
                                
                                <div class="signal-item">
                                    <div class="signal-info">
                                        <div class="signal-symbol">ETH/USDT</div>
                                        <div class="signal-time">4 часа назад</div>
                                    </div>
                                    <div class="signal-action sell">SELL</div>
                                    <div class="signal-profit negative">-1.1%</div>
                                    <div class="signal-status completed">Завершен</div>
                                </div>
                                
                                <div class="signal-item">
                                    <div class="signal-info">
                                        <div class="signal-symbol">ADA/USDT</div>
                                        <div class="signal-time">6 часов назад</div>
                                    </div>
                                    <div class="signal-action buy">BUY</div>
                                    <div class="signal-profit positive">+4.2%</div>
                                    <div class="signal-status active">Активен</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <h3>Быстрые действия</h3>
                        <div class="actions-grid">
                            <button class="action-card telegram">
                                <i class="fab fa-telegram"></i>
                                <span>Telegram Bot</span>
                                <small>Подключиться к боту</small>
                            </button>
                            <button class="action-card analytics">
                                <i class="fas fa-chart-line"></i>
                                <span>Экспорт данных</span>
                                <small>Скачать отчеты</small>
                            </button>
                            <button class="action-card settings">
                                <i class="fas fa-bell"></i>
                                <span>Уведомления</span>
                                <small>Настроить алерты</small>
                            </button>
                            <button class="action-card support">
                                <i class="fas fa-life-ring"></i>
                                <span>Поддержка</span>
                                <small>Связаться с нами</small>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Signals Tab -->
                <div class="tab-content" id="signalsTab">
                    <div class="signals-header">
                        <div class="signals-filters">
                            <select class="filter-select" id="pairFilter">
                                <option value="">Все пары</option>
                                <option value="BTC">BTC</option>
                                <option value="ETH">ETH</option>
                                <option value="BNB">BNB</option>
                            </select>
                            <select class="filter-select" id="typeFilter">
                                <option value="">Все типы</option>
                                <option value="LONG">LONG</option>
                                <option value="SHORT">SHORT</option>
                            </select>
                            <select class="filter-select" id="statusFilter">
                                <option value="">Все статусы</option>
                                <option value="active">Активные</option>
                                <option value="closed">Закрытые</option>
                                <option value="cancelled">Отмененные</option>
                            </select>
                        </div>
                        <div class="signals-actions">
                            <button class="btn secondary" id="exportSignals">
                                <i class="fas fa-download"></i>
                                Экспорт
                            </button>
                            <button class="btn primary" id="createSignal">
                                <i class="fas fa-plus"></i>
                                Новый сигнал
                            </button>
                        </div>
                    </div>
                    
                    <div class="signals-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Пара</th>
                                    <th>Тип</th>
                                    <th>Цена входа</th>
                                    <th>Текущая цена</th>
                                    <th>P&L</th>
                                    <th>Статус</th>
                                    <th>Время</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="signalsTableBody">
                                <!-- Данные будут загружены через JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div class="tab-content" id="analyticsTab">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3>Распределение по парам</h3>
                            <canvas id="pairsChart"></canvas>
                        </div>
                        <div class="analytics-card">
                            <h3>Результативность по типам</h3>
                            <canvas id="typesChart"></canvas>
                        </div>
                        <div class="analytics-card">
                            <h3>Динамика прибыли</h3>
                            <canvas id="profitChart"></canvas>
                        </div>
                        <div class="analytics-card">
                            <h3>Топ пары по прибыли</h3>
                            <div class="top-pairs" id="topPairs">
                                <!-- Будет заполнено через JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Tab -->
                <div class="tab-content" id="portfolioTab">
                    <div class="portfolio-summary">
                        <div class="portfolio-header">
                            <h3>Портфель</h3>
                            <div class="portfolio-value">
                                <span class="total-value">$12,458.90</span>
                                <span class="value-change positive">+$1,247.32 (11.2%)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="portfolio-grid">
                        <div class="portfolio-chart">
                            <h4>Распределение активов</h4>
                            <canvas id="portfolioChart"></canvas>
                        </div>
                        
                        <div class="portfolio-holdings">
                            <h4>Активы</h4>
                            <div class="holdings-list" id="holdingsList">
                                <!-- Будет заполнено через JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settingsTab">
                    <div class="settings-grid">
                        <div class="settings-section">
                            <h3>Профиль</h3>
                            <form class="settings-form" id="profileForm">
                                <div class="form-group">
                                    <label>Имя пользователя</label>
                                    <input type="text" id="settingsUsername" value="adm1n">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="settingsEmail" value="adm1n">
                                </div>
                                <button type="submit" class="btn primary">Сохранить</button>
                            </form>
                        </div>

                        <div class="settings-section">
                            <h3>Уведомления</h3>
                            <div class="settings-options">
                                <label class="setting-option">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    <span>Email уведомления о сигналах</span>
                                </label>
                                <label class="setting-option">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    <span>Telegram уведомления</span>
                                </label>
                                <label class="setting-option">
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                    <span>SMS уведомления</span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Безопасность</h3>
                            <div class="security-options">
                                <button class="btn secondary">Изменить пароль</button>
                                <button class="btn secondary">Настроить 2FA</button>
                                <button class="btn danger">Завершить все сессии</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>API настройки</h3>
                            <div class="api-keys">
                                <div class="api-key-item">
                                    <span>MEXC API Key</span>
                                    <span class="api-status connected">Подключен</span>
                                </div>
                                <button class="btn secondary">Управление API ключами</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Определяем среду выполнения -->
    <script>
        // Проверяем, работаем ли мы на GitHub Pages или локально
        const isGitHubPages = window.location.hostname.includes('github.io') || 
                             window.location.hostname.includes('github.com') ||
                             window.location.protocol === 'file:';
        
        console.log('🌐 Dashboard среда:', isGitHubPages ? 'GitHub Pages (статическая)' : 'Локальная с API');
    </script>
    
    <!-- Загружаем соответствующую систему -->
    <script>
        if (typeof isGitHubPages !== 'undefined' && isGitHubPages) {
            // Статическая система для GitHub Pages
            document.write('<script src="js/static-auth.js"><\/script>');
            document.write('<script src="js/static-dashboard.js"><\/script>');
        } else {
            // API система для локального сервера
            document.write('<script src="js/auth-integration.js"><\/script>');
            document.write('<script src="js/dashboard.js"><\/script>');
        }
    </script>
</body>
</html>